<div class="container">
  <h1>Favourite & Instant Fares portal</h1>

  <!-- Search Box centered -->
  <div class="search-box">
    <input
      type="text"
      placeholder="Search by title"
      [(ngModel)]="searchTerm"
      (input)="onSearch()"
      class="search-input"
    />
  </div>

  <!-- Posts Table -->
  <table mat-table [dataSource]="filteredPosts" multiTemplateDataRows class="mat-elevation-z8">
    
    <!-- ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef> ID </th>
      <td mat-cell *matCellDef="let post"> {{ post.id }} </td>
    </ng-container>

    <!-- Title Column -->
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef> Title </th>
      <td mat-cell *matCellDef="let post">
        <span (click)="toggleExpand(post, $event)" style="cursor: pointer;">
          {{ post.title }}
        </span>
        <div *ngIf="expandedPostIds.has(post.id)" class="expanded-content">
          <p><strong>ID:</strong> {{ post.id }}</p>
          <p><strong>Body:</strong> {{ post.body }}</p>
        </div>
      </td>
    </ng-container>

    <!-- Edit and Delete Button Column -->
    <ng-container matColumnDef="expand">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let post">
        <button (click)="editPost(post)">Edit</button>
        <button (click)="deletePost(post)">Delete</button>
      </td>
    </ng-container>

    <!-- Header Row -->
    <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>

    <!-- Data Row -->
    <tr mat-row *matRowDef="let post; columns: columnsToDisplayWithExpand;" (click)="toggleExpand(post, $event)"></tr>
  </table>

  <!-- Edit Modal -->
  <div *ngIf="editMode" class="edit-modal" (click)="stopRowExpand($event)">
    <div class="edit-form-card" (click)="stopRowExpand($event)">
      <h2>Edit Post</h2>
      <mat-form-field appearance="fill">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="currentPost.title" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Body</mat-label>
        <textarea matInput [(ngModel)]="currentPost.body"></textarea>
      </mat-form-field>

      <div class="button-group">
        <button mat-raised-button color="primary" (click)="savePost()">Save</button>
        <button mat-raised-button color="warn" (click)="cancelEdit()">Cancel</button>
      </div>
    </div>
  </div>
</div>
